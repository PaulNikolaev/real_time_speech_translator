"""
–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ —Ä–µ—á–∏.
–ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ —Ä–µ—á–∏ —Å —Ä—É—Å—Å–∫–æ–≥–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏–ª–∏ —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π —è–∑—ã–∫.
"""

from core import SpeechTranslator
from config import DEVICE, print_gpu_info


def select_target_language() -> str:
    """–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä —Ü–µ–ª–µ–≤–æ–≥–æ —è–∑—ã–∫–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞.

    Returns:
        –ö–æ–¥ —Ü–µ–ª–µ–≤–æ–≥–æ —è–∑—ã–∫–∞ ('en' –∏–ª–∏ 'fr').
    """
    print("\n" + "=" * 60)
    print("–í–´–ë–û–† –¶–ï–õ–ï–í–û–ì–û –Ø–ó–´–ö–ê")
    print("=" * 60)
    print("1. –ê–Ω–≥–ª–∏–π—Å–∫–∏–π (English)")
    print("2. –§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π (Fran√ßais)")
    print("=" * 60)

    while True:
        choice = input("\n–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª–µ–≤–æ–π —è–∑—ã–∫ (1 –∏–ª–∏ 2): ").strip()

        if choice == "1":
            return "en"
        elif choice == "2":
            return "fr"
        else:
            print("‚ö† –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –í–≤–µ–¥–∏—Ç–µ 1 –∏–ª–∏ 2.")


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è."""
    print("=" * 60)
    print("–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ —Ä–µ—á–∏: –†—É—Å—Å–∫–∏–π -> –ê–Ω–≥–ª–∏–π—Å–∫–∏–π/–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π")
    print("=" * 60)
    print(f"–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: {DEVICE}")
    print()
    print_gpu_info()

    target_lang = select_target_language()
    lang_names = {"en": "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π", "fr": "–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π"}
    print(f"\n‚úì –í—ã–±—Ä–∞–Ω —Ü–µ–ª–µ–≤–æ–π —è–∑—ã–∫: {lang_names[target_lang]}")

    translator = SpeechTranslator(target_lang=target_lang)

    print("\n" + "=" * 60)
    print("–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ!")
    print(f"–ü–µ—Ä–µ–≤–æ–¥: –†—É—Å—Å–∫–∏–π -> {lang_names[target_lang]}")
    print("=" * 60)
    print("\nüìå –ò–ù–°–¢–†–£–ö–¶–ò–Ø:")
    print("  ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏")
    print("  ‚Ä¢ –ì–æ–≤–æ—Ä–∏—Ç–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ (–∑–∞–ø–∏—Å—å –¥–ª–∏—Ç—Å—è 5 —Å–µ–∫—É–Ω–¥)")
    print("  ‚Ä¢ –î–æ–∂–¥–∏—Ç–µ—Å—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞")
    print("  ‚Ä¢ –ó–∞—Ç–µ–º –º–æ–∂–µ—Ç–µ —Å–Ω–æ–≤–∞ –Ω–∞–∂–∞—Ç—å Enter –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏")
    print("  ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –≤—ã—Ö–æ–¥–∞")
    print("=" * 60)

    iteration = 0
    while True:
        try:
            iteration += 1
            if iteration > 1:
                print(f"\n{'='*60}")
                print(f"–ì–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ (–∏—Ç–µ—Ä–∞—Ü–∏—è #{iteration})")
                print(f"{'='*60}")
            input("\n‚è∫ –ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏...")
            translator.process()
            print(f"\n‚úì –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ì–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏...")
        except KeyboardInterrupt:
            print("\n\n–í—ã—Ö–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...")
            break
        except Exception as e:
            print(f"\n–û—à–∏–±–∫–∞: {e}")
            print("–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑...")


if __name__ == "__main__":
    main()